Sub fuckfuckfuckfuck()

' This file is used to compare MASTER vs ITEMin
    ' Left Blank, File Date, Email Receipients
' Log out the differences
' Ex: Wrong file name, missing data in a column(s).

' create system objects for file handling
Set objExcel = CreateObject("Excel.Application")
Set objExcel2 = CreateObject("Excel.Application")

' Log file stuffs - Initially create/clear it
Set objOutput = CreateObject("Scripting.FileSystemObject") ' changed from objFTPOutput to objOutput
logFileName = "C:\Users\ekim\Desktop\Projects\hello\full.log"
Set logFile = objOutput.CreateTextFile(logFileName, True)
logFile.Write "Datetime of Log Creation: " & Now() & vbCrLf
logFile.Write "-------------------------------------------------------------" & vbCrLf

' path to the excel file
Set objWorkbook = objExcel.Workbooks.Open _
("C:\Users\ekim\Desktop\Projects\hello\ITEMin000.xlsx")

Set objWorkbook2 = objExcel2.Workbooks.Open _
("C:\Users\ekim\Desktop\Projects\hello\MASTER000.xlsx")


' start at the second row, ie, not the column header
intRow = 2

' Below for analysis purpose
intSucess = 0

' loop through each row of the excel file
Do Until objExcel.Cells(intRow, 1).Value = ""
    
' grab the rest of the excel file information
' If the first cell is blank exit the program (SHM)
client = Trim(objExcel.Cells(intRow, 1).Value)
If client = "" Then
    ''''exit do
End If

' Fetch the data to compare it with Master later
file_date = Trim(objExcel.Cells(intRow, 10).Value)
file_left = Trim(objExcel.Cells(intRow, 14).Value)
send_to = Trim(objExcel.Cells(intRow, 1).Value)
email_to = Trim(objExcel.Cells(intRow, 2).Value)
email_cc = Trim(objExcel.Cells(intRow, 3).Value)
email_bcc = Trim(objExcel.Cells(intRow, 4).Value)
file_fullname = Trim(objExcel.Cells(intRow, 9).Value)


Dim dataFound As Boolean
dataFound = False
Dim logFlags As String
Dim logFlags1(5) As String

' loop against the MASTER file
'''''''''''''' ISSUEEEEEEEEEE: Only gets call for first outer loop
For Each sh In objWorkbook2.Worksheets
    If sh.Index = 1 Then GoTo NextIteration

    ' test here
    testShName = ""
    testRowName = ""


    ' In each worksheet in MASTER, check each row for the matching record
    For Each rw In sh.Rows
    
        logFlags1(0) = "0"
        logFlags1(1) = "0"
        logFlags1(2) = "0"
        logFlags1(3) = "0"
        logFlags1(4) = "0"
        logFlags1(5) = "0"
        
        Dim keepSearching As Boolean
        keepSearching = False
                
        ' Check further comparison if send_to data matches
        If send_to = rw.Cells(1).Value Then
            
            
            ' Fetch the data to compare it with Master later
            send_to2 = rw.Cells(1).Value
            file_left2 = rw.Cells(14).Value
            file_date2 = rw.Cells(10).Value
            email_to2 = rw.Cells(2).Value
            email_cc2 = rw.Cells(3).Value
            email_bcc2 = rw.Cells(4).Value
            
            ' Below checks for any failure/unmatched. If so, log this bad boys
            logFlags1(0) = "0" ' Initialize to 0 since we know send_to equals send_to2
            If file_left <> file_left2 Then
                keepSearching = True
                logFlags1(1) = "1"
            End If
            If file_date <> file_date2 Then keepSearching = True: logFlags1(2) = "1"
            If email_to <> email_to2 Then keepSearching = True: logFlags1(3) = "1"
            If email_cc <> email_cc2 Then keepSearching = True: logFlags1(4) = "1"
            If email_bcc <> email_bcc2 Then keepSearching = True: logFlags1(5) = "1" ': logFile.Write "           Shit: " & sh.Name & "   Row:" & rw.Row & ": " & email_bcc & " || " & email_bcc2

            
            ' Below checks if a correct record is found in MASTER. If so, log this good too
            If keepSearching = False Then dataFound = True
            If dataFound = True Then
                logFile.Write "     wtfwtf Found at: " & sh.Name & " | " & rw.Row & ".... logFlags(" & logFlags1(5) & "): " & email_bcc & " | " & email_bcc2 & vbCrLf

                testShName = CStr(sh.Name)
                testRowName = CStr(rw.Row)
                intSuccess = intSuccess + 1
                Exit For
            End If
            
            logFile.Write vbCrLf
        Else
            logFlags1(0) = "1"
            logFlags1(1) = "1"
        End If
        
        
        If rw.Row >= 200 Then
            '''''MsgBox "200 reached" + CStr(goNextSheet) + "  " + CStr(dataFound)
            Exit For
        End If
    Next rw
    

NextIteration:
    ' If the matching record is found in MASTER, then we just move to next item in ITEMin file.
    If dataFound = True Then
        dataFound = False
        Exit For
    End If
    
Next sh
intRow = intRow + 1


If logFlags1(0) = "1" And logFlags1(1) = "1" Then
    ' Output to Log
    logFile.Write "Flags: #" & logFlags1(0) & logFlags1(1) & logFlags1(2) & logFlags1(3) & logFlags1(4) & logFlags1(5) & "   " & send_to & "|" & file_left & vbCrLf
    logFile.Write "     #" & send_to & " = " & send_to2 & vbCrLf & "     " & file_left & " = " & file_left2 & vbCrLf
    logFile.Write "     #" & testShName & " | " & testRowName & vbCrLf
    logFile.Write "     dataFound: " & dataFound & vbCrLf
    logFile.Write "     Fail!!!: " & file_left & "   =    " & file_left2 & vbCrLf
    
    If logFlags1(2) = "1" Then logFile.Write "      File Date is not matching!" & vbCrLf
    If logFlags1(3) = "1" Then logFile.Write "      CC Email is not matching!" & vbCrLf
    If logFlags1(4) = "1" Then logFile.Write "      BCC Email is not matching!" & vbCrLf
    If logFlags1(5) = "1" Then logFile.Write "      File Fullname is not matching!" & vbCrLf
Else
    ' Output to Log
    logFile.Write "Flags: " & logFlags1(0) & logFlags1(1) & logFlags1(2) & logFlags1(3) & logFlags1(4) & logFlags1(5) & "   " & send_to & "|" & file_left & vbCrLf
    logFile.Write "     #" & send_to & " = " & send_to2 & vbCrLf & "     " & file_left & " = " & file_left2 & vbCrLf
    logFile.Write "     #" & testShName & " | " & testRowName & vbCrLf
    logFile.Write "     dataFound: " & dataFound & vbCrLf


    'logFile.Write "---> Output logging for " & file_fullname & "  - " & send_to & "~!" & vbCrLf
    logFile.Write "     Success!!!" & vbCrLf
    logFile.Write "        send_to: " & send_to & "|" & send_to2 & vbCrLf
    logFile.Write "        file_left: " & file_left & "|" & file_left2 & vbCrLf
    logFile.Write "        email_cc: " & email_cc & "|" & email_cc2 & vbCrLf
    logFile.Write "        email_bcc: " & email_bcc & "|" & email_bcc2 & vbCrLf

End If

logFile.Write vbCrLf & vbCrLf

' End of Loop!
Loop

' Output the Success/Failure Rate to Log File
logFile.Write "Total Record: " & CStr(intRow - 2) & vbCrLf & _
       "Success: " & CStr(intSuccess) & vbCrLf & _
       "Failure: " & CStr(intRow - 2 - intSuccess)

' Output the Success/Failure Rate as a Pop-up message
MsgBox "Total Record: " & CStr(intRow - 2) & vbCrLf & _
       "Success: " & CStr(intSuccess) & vbCrLf & _
       "Failure: " & CStr(intRow - 2 - intSuccess)


objWorkbook.Close
objExcel.Quit
objWorkbook2.Close
objExcel2.Quit

End Sub


